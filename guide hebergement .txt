# üöÄ Guide Complet d'H√©bergement Gratuit

## Vue d'ensemble

Vous allez h√©berger **GRATUITEMENT** votre projet sur :
- **Streamlit Cloud** : Pour l'application web (interface)
- **Neon.tech** : Pour la base de donn√©es PostgreSQL

**Co√ªt total : 0‚Ç¨ / mois** ‚úÖ

---

## üìã PARTIE 1 : H√©berger la Base de Donn√©es (Neon.tech)

### √âtape 1.1 : Cr√©er un compte Neon

1. Allez sur : **https://neon.tech**
2. Cliquez sur **"Sign Up"**
3. Connectez-vous avec **GitHub** (recommand√©) ou email
4. Confirmez votre email

### √âtape 1.2 : Cr√©er votre projet PostgreSQL

1. Une fois connect√©, cliquez sur **"Create Project"**
2. Configurez :
   - **Project name** : `num-exam-db`
   - **Region** : Choisissez **Europe (Frankfurt)** ou le plus proche
   - **PostgreSQL version** : 15 (par d√©faut)
3. Cliquez sur **"Create Project"**

### √âtape 1.3 : R√©cup√©rer les identifiants de connexion

Neon vous donne une **Connection String** qui ressemble √† :

```
postgresql://username:password@ep-xxx.eu-central-1.aws.neon.tech/neondb?sslmode=require
```

**Gardez cette cha√Æne pr√©cieusement !** ‚ö†Ô∏è

**D√©composition :**
- **Host** : `ep-xxx.eu-central-1.aws.neon.tech`
- **Database** : `neondb`
- **User** : `username`
- **Password** : `password`
- **Port** : `5432`

### √âtape 1.4 : Cr√©er le sch√©ma sur Neon

1. Cliquez sur **"SQL Editor"** dans le menu de gauche
2. Copiez tout le contenu de votre fichier **`schema.sql`**
3. Collez dans l'√©diteur SQL
4. Cliquez sur **"Run"**
5. V√©rifiez qu'il n'y a pas d'erreurs (‚úÖ toutes les tables doivent √™tre cr√©√©es)

### √âtape 1.5 : G√©n√©rer les donn√©es sur Neon

**Option A : Via script Python local**

```python
# Modifiez database/seed_data.py
DB_CONFIG = {
    'dbname': 'neondb',
    'user': 'votre_username_neon',
    'password': 'votre_password_neon',
    'host': 'ep-xxx.eu-central-1.aws.neon.tech',
    'port': 5432,
    'sslmode': 'require'  # IMPORTANT pour Neon
}

# Puis ex√©cutez
python database/seed_data.py
```

**Option B : Via SQL Editor (plus rapide pour test)**

G√©n√©rez un petit dataset de test :
```sql
-- Ins√©rer 7 d√©partements
INSERT INTO departements (nom, code, responsable_nom) VALUES
('Informatique', 'INFO', 'Dr. Benali'),
('Math√©matiques', 'MATH', 'Dr. Rahmouni'),
('Physique', 'PHYS', 'Dr. Khelifi'),
('Chimie', 'CHIM', 'Dr. Mansouri'),
('Biologie', 'BIO', 'Dr. Amrani'),
('G√©nie Civil', 'GC', 'Dr. Bouazza'),
('√âlectronique', 'ELEC', 'Dr. Chaoui');

-- Etc. (donn√©es de test minimales)
```

---

## üìã PARTIE 2 : H√©berger l'Application (Streamlit Cloud)

### √âtape 2.1 : Pr√©parer votre d√©p√¥t GitHub

1. **Cr√©ez un compte GitHub** (si pas d√©j√† fait) : https://github.com
2. **Cr√©ez un nouveau d√©p√¥t** :
   - Nom : `num-exam-platform`
   - Visibilit√© : **Public** (requis pour Streamlit Cloud gratuit)
   - Cochez **"Add README"**

3. **Poussez votre code sur GitHub** :

```bash
# Dans votre dossier projet
git init
git add .
git commit -m "Initial commit - Plateforme Num_Exam"
git branch -M main
git remote add origin https://github.com/VOTRE_USERNAME/num-exam-platform.git
git push -u origin main
```

### √âtape 2.2 : Structure obligatoire pour Streamlit Cloud

Votre d√©p√¥t GitHub doit avoir cette structure :

```
num-exam-platform/
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ app.py                    # Point d'entr√©e
‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îú‚îÄ‚îÄ 1_üèõÔ∏è_Dashboard_Doyen.py
‚îÇ       ‚îú‚îÄ‚îÄ 2_üë®‚Äçüíº_Admin_Examens.py
‚îÇ       ‚îú‚îÄ‚îÄ 3_üìä_Chef_Departement.py
‚îÇ       ‚îî‚îÄ‚îÄ 4_üë•_Consultation.py
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ database.py
‚îÇ   ‚îú‚îÄ‚îÄ optimizer.py
‚îÇ   ‚îî‚îÄ‚îÄ conflict_detector.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .streamlit/
‚îÇ   ‚îî‚îÄ‚îÄ config.toml          # √Ä cr√©er !
‚îî‚îÄ‚îÄ README.md
```

### √âtape 2.3 : Cr√©er le fichier de configuration Streamlit

Cr√©ez le dossier `.streamlit/` et le fichier `config.toml` :

```toml
[theme]
primaryColor = "#667eea"
backgroundColor = "#FFFFFF"
secondaryBackgroundColor = "#F0F2F6"
textColor = "#262730"
font = "sans serif"

[server]
headless = true
port = 8501
enableCORS = false
```

### √âtape 2.4 : Modifier config.py pour Streamlit Cloud

**Fichier : `backend/config.py`**

Ajoutez cette section en haut :

```python
import os
from dotenv import load_dotenv

# Charger les variables d'environnement
load_dotenv()

class DatabaseConfig:
    """Configuration PostgreSQL"""
    
    # STREAMLIT CLOUD : Utiliser secrets
    if os.getenv('STREAMLIT_CLOUD') == 'true':
        import streamlit as st
        DB_HOST = st.secrets["database"]["host"]
        DB_PORT = st.secrets["database"]["port"]
        DB_NAME = st.secrets["database"]["name"]
        DB_USER = st.secrets["database"]["user"]
        DB_PASSWORD = st.secrets["database"]["password"]
    else:
        # LOCAL : Utiliser .env
        DB_HOST = os.getenv('DB_HOST', 'localhost')
        DB_PORT = os.getenv('DB_PORT', '5432')
        DB_NAME = os.getenv('DB_NAME', 'num_exam_db')
        DB_USER = os.getenv('DB_USER', 'postgres')
        DB_PASSWORD = os.getenv('DB_PASSWORD', 'postgres')
    
    # URL de connexion avec SSL pour Neon
    DATABASE_URL = f"postgresql://{DB_USER}:{DB_PASSWORD}@{DB_HOST}:{DB_PORT}/{DB_NAME}?sslmode=require"
    
    DB_CONFIG = {
        'dbname': DB_NAME,
        'user': DB_USER,
        'password': DB_PASSWORD,
        'host': DB_HOST,
        'port': DB_PORT,
        'sslmode': 'require'  # IMPORTANT pour Neon
    }
```

### √âtape 2.5 : Cr√©er un compte Streamlit Cloud

1. Allez sur : **https://streamlit.io/cloud**
2. Cliquez sur **"Sign up"**
3. Connectez-vous avec **GitHub** (obligatoire)
4. Autorisez Streamlit √† acc√©der √† vos d√©p√¥ts

### √âtape 2.6 : D√©ployer votre application

1. Cliquez sur **"New app"**
2. Configurez :
   - **Repository** : S√©lectionnez `num-exam-platform`
   - **Branch** : `main`
   - **Main file path** : `frontend/app.py`
3. Cliquez sur **"Advanced settings"**

### √âtape 2.7 : Configurer les Secrets (CRITIQUE !)

Dans **"Advanced settings"**, section **"Secrets"**, ajoutez :

```toml
# Secrets pour Streamlit Cloud
STREAMLIT_CLOUD = "true"

[database]
host = "ep-xxx.eu-central-1.aws.neon.tech"
port = "5432"
name = "neondb"
user = "votre_username_neon"
password = "votre_password_neon"
```

‚ö†Ô∏è **Remplacez avec VOS vraies valeurs Neon !**

### √âtape 2.8 : Lancer le d√©ploiement

1. Cliquez sur **"Deploy!"**
2. Attendez 2-5 minutes (Streamlit installe les d√©pendances)
3. Votre app sera disponible sur : **`https://votre-app.streamlit.app`**

---

## üéâ PARTIE 3 : V√©rifications Post-D√©ploiement

### Test 1 : Connexion √† la base de donn√©es

1. Ouvrez votre app sur `https://votre-app.streamlit.app`
2. Dans la sidebar, cliquez sur **"Tester la connexion"**
3. Vous devez voir : **‚úÖ Connect√©**

### Test 2 : G√©n√©ration d'un emploi du temps

1. Allez dans **Pages ‚Üí Admin Examens**
2. Cliquez sur **"G√©n√©rer l'emploi du temps"**
3. Si √ßa marche ‚Üí **SUCC√àS !** üéâ

### Test 3 : Consultation

1. Allez dans **Pages ‚Üí Consultation**
2. Testez avec un matricule (ex: `E202400001`)
3. V√©rifiez que les examens s'affichent

---

## ‚ö†Ô∏è PROBL√àMES FR√âQUENTS & SOLUTIONS

### ‚ùå Erreur : "Connection refused"

**Cause** : Mauvais identifiants Neon

**Solution** :
1. Retournez sur Neon.tech
2. Copiez √† nouveau la Connection String
3. Mettez √† jour les Secrets dans Streamlit Cloud
4. Cliquez sur **"Reboot app"**

### ‚ùå Erreur : "Module not found"

**Cause** : D√©pendance manquante dans `requirements.txt`

**Solution** :
1. V√©rifiez que TOUTES les d√©pendances sont dans `requirements.txt`
2. Commitez et poussez :
```bash
git add requirements.txt
git commit -m "Fix dependencies"
git push
```
3. Streamlit red√©ploiera automatiquement

### ‚ùå Erreur : "SSL connection required"

**Cause** : Oubli du `sslmode=require` pour Neon

**Solution** :
- Ajoutez `'sslmode': 'require'` dans `DB_CONFIG`

### ‚ùå L'app est lente

**Cause** : Free tier de Neon (limit√©)

**Solutions** :
- R√©duisez la quantit√© de donn√©es (g√©n√©rer 1000 √©tudiants au lieu de 13000)
- Ajoutez des index SQL sur les colonnes fr√©quemment requ√™t√©es
- Utilisez `@st.cache_data` pour les requ√™tes r√©p√©t√©es

---

## üìä PARTIE 4 : Optimisations Performance

### Optimisation 1 : Caching Streamlit

Ajoutez dans vos fichiers pages :

```python
@st.cache_data(ttl=600)  # Cache 10 minutes
def charger_donnees():
    # Vos requ√™tes ici
    return data
```

### Optimisation 2 : Index SQL

Ex√©cutez dans Neon SQL Editor :

```sql
-- Index sur les colonnes fr√©quemment filtr√©es
CREATE INDEX IF NOT EXISTS idx_examens_date ON examens(date_examen);
CREATE INDEX IF NOT EXISTS idx_examens_statut ON examens(statut);
CREATE INDEX IF NOT EXISTS idx_inscriptions_etudiant ON inscriptions(etudiant_id);
CREATE INDEX IF NOT EXISTS idx_surveillances_prof ON surveillances(professeur_id);
```

### Optimisation 3 : Compression des donn√©es

Dans `seed_data.py`, g√©n√©rez moins de donn√©es pour le d√©ploiement :

```python
# Version production (pour h√©bergement gratuit)
generate_etudiants(conn, target=2000)  # Au lieu de 13000
```

---

## üîó LIENS FINAUX √Ä SOUMETTRE

Une fois d√©ploy√©, vous aurez :

### 1Ô∏è‚É£ Lien de l'application
```
https://votre-nom-num-exam.streamlit.app
```

### 2Ô∏è‚É£ Lien GitHub (code source)
```
https://github.com/votre-username/num-exam-platform
```

### 3Ô∏è‚É£ Lien vid√©o YouTube
```
https://youtube.com/watch?v=xxxxx
(√Ä faire apr√®s d√©ploiement)
```

---

## üìù CHECKLIST AVANT SOUMISSION

- [ ] Application d√©ploy√©e et accessible
- [ ] Base de donn√©es Neon fonctionnelle
- [ ] Test de g√©n√©ration EDT r√©ussi
- [ ] Test de d√©tection conflits r√©ussi
- [ ] Test de consultation √©tudiant/prof r√©ussi
- [ ] Code source sur GitHub (public)
- [ ] README.md √† jour avec lien d√©ployement
- [ ] Rapport technique r√©dig√© (10-15 pages)
- [ ] Vid√©o YouTube enregistr√©e (5-10 min)
- [ ] Liens soumis sur Classroom avant le 19/01/2026 23:59

---

